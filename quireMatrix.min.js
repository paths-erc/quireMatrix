var Matrix=function(e){function t(){v.moveTo(0,d-k*p),v.lineTo(b/2,d-(k-1)*p)}function n(){v.beginPath(),t(),v.stroke()}function o(){v.beginPath(),v.moveTo(b/2,d-(k-1)*p),v.lineTo(b,d-p*k),v.stroke()}function i(){v.beginPath(),v.moveTo(b,d-k*p),v.lineTo(b/2,d-(k-1)*p),v.lineTo(b/2-b/10,d-k*p+.75*p),v.stroke()}function s(){v.beginPath(),v.setLineDash([5]),v.moveTo(0,d-k*p),v.lineTo(b/2,d-(k-1)*p),v.stroke(),v.setLineDash([]),v.beginPath(),v.moveTo(b/2,d-(k-1)*p),v.lineTo(b,d-p*k),v.stroke()}function a(){v.beginPath(),t(),v.lineTo(b/2+b/10,d-k*p+.75*p),v.stroke()}function r(){v.beginPath(),t(),v.lineTo(b,d-p*k),v.stroke()}function h(){v.beginPath(),v.setLineDash([5]),t(),v.lineTo(b,d-p*k),v.stroke(),v.setLineDash([])}function c(){v.beginPath(),v.moveTo(0,d-k*p),v.lineTo(b/2,d-(k-1)*p),v.stroke(),v.beginPath(),v.setLineDash([5]),v.moveTo(b/2,d-(k-1)*p),v.lineTo(b,d-p*k),v.stroke(),v.setLineDash([])}function l(e){v.beginPath(),e&&v.setLineDash([5]),t(),v.lineTo(0,d-k*p-p/2),v.stroke(),v.setLineDash([])}function g(e){v.beginPath(),e&&v.setLineDash([5]),t(),v.lineTo(0,d-k*p-p/3),v.stroke(),v.moveTo(b/2,d-(k-1)*p),v.lineTo(0,d-k*p-2*p/3),v.stroke(),v.setLineDash([])}function u(e){v.beginPath(),e&&v.setLineDash([5]),t(),v.lineTo(0,d-k*p-p/4),v.stroke(),v.moveTo(b/2,d-(k-1)*p),v.lineTo(0,d-k*p-2*p/4),v.stroke(),v.moveTo(b/2,d-(k-1)*p),v.lineTo(0,d-k*p-3*p/4),v.stroke(),v.setLineDash([])}function T(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}var f="string"==typeof e?document.getElementById(e):e[0],v=f.getContext("2d"),d=f.height,b=f.width,p=20,k=1,m={0:"1",1:"0","0*":"1*","1*":"0*","0+":"1+","1+":"0+","1x":"1x",2:"0","2*":"0",3:"0","3*":"0",4:"0","4*":"0"};v.lineWidth=1.5,this.addRow=function(e){"1"===e?n():"1+"===e?a():"1x"===e?r():"1x*"===e?h():"1*"===e?c():"0"===e?o():"0*"===e?s():"0+"===e?i():"2"===e?l():"2*"===e?l(!0):"3"===e?g():"3*"===e?g(!0):"4"===e?u():"4*"===e&&u(!0),k++},this.clear=function(){k=1,v.clearRect(0,0,b,d),v.beginPath()},this.parseString=function(e,t){var n=this,o=!!t&&("string"==typeof t?document.getElementById(t):t[0]),i=0;if(n.clear(),!e||""===e)return"";var s=e.replace(/\/$/,"").split("/");s.length>3&&(d=50+s.length*p,f.setAttribute("height",d)),s.forEach(function(e){e&&("1x*"!==e&&(i+=parseInt(e.replace("*","").replace("x",""))),n.addRow(e))});var a=s.reverse();a.forEach(function(e,t,n){if(void 0!==m[e]&&(n[t]=m[e]),e&&"1x*"!==n[t]){var o=n[t]?parseInt(n[t].replace("*","").replace("x","")):0;i+=isNaN(o)?0:o}});var r={text:a.join("/"),tot:2*i};return o?(o.innerHTML="",o.innerHTML="<code><strong>"+r.text+"</strong></code><br>Total: <strong>"+r.tot+"</strong> pages"):console.log(r),r},this.observeInput=function(e,t){var n="string"==typeof e?document.getElementById(e):e[0],o=this;o.parseString(n.value,t),T(n,"input",function(){o.parseString(n.value,t)})}};
